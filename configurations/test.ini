# ============================================================================
# MiniFlow Test Configuration
# ============================================================================
# This configuration file is used when APP_ENV=test
# All values are optimized for testing with minimal resources

[Test]
# Test validation key (required for configuration validation)
value = ThisKeyIsForConfigTest

[Database]
# Database connection settings
db_type = sqlite
db_path = :memory:
db_name = miniflow_test
db_host = localhost
db_port = 5432
db_user = test_user
db_password = test_password
seed_data_path = ./seeds/

[Redis]
# Redis connection settings for rate limiting and caching
host = localhost
port = 6379
db = 0
password = 
max_connections = 10
socket_timeout = 2
socket_connect_timeout = 2
decode_responses = True

[Rate Limiting]
# IP-based rate limiting (middleware level)
ip_requests_per_minute = 1000
ip_requests_per_hour = 10000

# User-based rate limiting (JWT authenticated requests)
user_requests_per_minute = 600
user_requests_per_hour = 6000
user_requests_per_day = 60000

[AUTH]
# Login rate limiting
max_failed_attempts = 5
rate_limit_window_minutes = 5

# Lockout escalation (tiered locking system)
# Lockout duration formula: base * (2 ^ (lock_count - 1))
# Example: base=15 â†’ 15min, 30min, 60min, then permanent
lockout_base_duration_minutes = 15
max_lockouts_before_permanent = 3
lockout_history_window_hours = 24

# Session management
max_active_sessions = 5

# Login history retention
max_login_history_per_user = 10

# Password history (prevent reuse)
max_password_history_count = 5

[USER]
# Account deletion grace period
deletion_grace_period_days = 30

[JWT Settings]
# JWT token expiration settings
jwt_access_token_expire_minutes = 5
jwt_refresh_token_expire_days = 1
access_token_type = access
refresh_token_type = refresh

[FILE OPERATIONS]
# File upload limits and restrictions
max_file_size_mb = 10
allowed_extensions = .pdf,.txt,.csv,.json
blocked_extensions = .exe,.bat,.cmd
allowed_mime_types = application/pdf,text/plain,text/csv,application/json

[CUSTOM SCRIPTS]
# Custom script upload settings
allowed_script_extensions = .py
allowed_script_mime_types = text/x-python
max_script_size_mb = 1
script_validation_enabled = true

[GLOBAL SCRIPTS]
# Global script upload settings
allowed_script_extensions = .py
allowed_script_mime_types = text/x-python
max_script_size_mb = 5

[WORKFLOW]
# Workflow trigger limits
min_triggers_per_workflow = 1
max_triggers_per_workflow = 10

# Node execution defaults
default_max_retries = 3
default_timeout_seconds = 300

[SCHEDULER_SERVICE]
# Type conversion accepted values
accepted_string_values = string,text,str
accepted_integer_values = number,integer,int
accepted_float_values = float
accepted_boolean_values = bool,boolean
accepted_array_values = array,list
accepted_object_values = object,dict,json

[INPUT_HANDLER]
# Input handler configuration (execution input processing)
input_handler_batch_size = 10
input_handler_worker_threads = 2
input_handler_max_retries = 2
input_handler_context_timeout = 10.0
input_handler_engine_timeout = 30.0
input_handler_min_polling_interval = 0.1
input_handler_max_polling_interval = 2.0
input_handler_retry_delay = 0.5
input_handler_adaptive_polling = false
input_handler_parallel_context = true

[OUTPUT_HANDLER]
# Output handler configuration (execution result processing)
output_handler_batch_size = 10
output_handler_worker_threads = 2
output_handler_max_retries = 2
output_handler_result_timeout = 30.0
output_handler_min_polling_interval = 0.1
output_handler_max_polling_interval = 2.0
output_handler_retry_delay = 0.5
output_handler_adaptive_polling = false
output_handler_parallel_processing = true

[Mailtrap]
# Mailtrap email service configuration
# Note: MAILTRAP_API_KEY must be set in .env file
sender_email = test@example.com
sender_name = MiniFlow Test
welcome_template_id = 
verification_template_id = 
password_reset_template_id = 
notification_template_id = 

[Server]
# FastAPI server configuration
title = Miniflow Test API
description = Workflow automation and management API (Testing)
version = 1.0.0-test
allowed_origins = *
host = 127.0.0.1
port = 8001
reload = False
workers = 1
